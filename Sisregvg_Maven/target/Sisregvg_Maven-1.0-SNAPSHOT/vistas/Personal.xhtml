<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./Plantilla.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions">

    <ui:define name="content">
        <h:head>
            <title>Listado del Personal</title>
            <f:event listener="#{personaC.listar()}" type="preRenderView" />
        </h:head>
        <h:body>      
            <h:outputStylesheet name="primeicons/primeicons.css" library="primefaces" />

            <p:growl id="mensaje" showDetail="true" />
            <p:growl id="growl-sticky" for="sticky-key" showDetail="true" sticky="true" />

            <h:form id="form">
                <center>
                    <!--    Formulario del personal    >-->         
                    <p:panelGrid columns="3">
                        <f:facet name= "header"> DATOS DEl PERSONAL </f:facet>

                        <p:outputLabel value="DNI" />
                        <p:commandButton value="Buscar" action="#{personaC.buscarDNI()}"  update="form">
                            <p:inputText id="DNI" value="#{personaC.per.dni}" maxlength="8"   requiredMessage="Digitar el dni">
                                <p:keyFilter regEx="/[0-9]/" />
                                <f:validator validatorId="vDni" />
                                <p:ajax  update="msgDni" delay="800" event="keyup" />
                                <p:tooltip for="DNI" value="Digite su Dni" trackMouse="focus"/>
                            </p:inputText> 
                        </p:commandButton>
                        <p:message id="msgDni" for="DNI"  showDetail="true" />

                        <p:outputLabel value="Nombre" for ="NOMPER"/>
                        <p:inputText id="NOMPER"  value="#{personaC.per.nombre}" maxlength="30"  requiredMessage="Digitar sus nombres">
                            <p:keyFilter regEx="/[A-Z_a-z_ñ_á_é_í_ó_ú_ ]/"/>
                            <!--                            <f:validator validatorId="Nombres" />-->
                            <p:ajax update="msgNombres" event="keyup" delay="800"  />
                            <p:tooltip for="NOMPER" value="Digite sus dos nombres" trackMouse="focus"/>
                        </p:inputText> 
                        <p:message  id="msgNombres" for="NOMPER" />
                        <p:outputLabel value="Apellido" />
                        <p:inputText id="APEPER"  value="#{personaC.per.apellido}" maxlength="30"   requiredMessage="Digitar sus apellidos">
                            <p:keyFilter regEx="/[A-Z_a-z_ñ_á_é_í_ó_ú_ ]/"/>
                            <!--                            <f:validator validatorId="Apellidos" />-->
                            <p:ajax update="msgApellidos" event="keyup" delay="800"  />
                            <p:tooltip for="APEPER" value="Digite sus dos apellidos" trackMouse="focus"/>
                        </p:inputText> 
                        <p:message  id="msgApellidos" for="APEPER" />


                        <p:outputLabel value="Celular" for="celular"/> 
                        <p:inputText id="celular" value="#{personaC.per.celular}" maxlength="9" style="width: 310px;" requiredMessage="Digitar su Celular">
                            <p:keyFilter regEx="/[0-9]/"/>
                            <f:validator validatorId="vCelular" />
<!--                            <f:validateLength minimum="9" maximum="9"/>-->
                            <p:ajax update="msgCelular" event="keyup" delay="800"  />
                            <p:tooltip for="celular" value="Digite su Celular" trackMouse="focus"/>
                        </p:inputText>                   
                        <p:message id="msgCelular" for="celular"/>

                        <p:outputLabel value = "Email" for="txtCorreo"/>
                        <p:inputText value ="#{personaC.per.email}" id="txtCorreo" maxlength="50" 
                                     requiredMessage="Ingrese correo electrónico" style="width: 100%" >
                            <f:validator validatorId="vCorreo" />
                            <p:ajax  update="msgCorreo" delay="800" event="keyup" />
                            <p:tooltip for="txtCorreo" value="Digite su Correo" trackMouse="focus"/>
                        </p:inputText>
                        <p:message id="msgCorreo" for="txtCorreo"  showDetail="true" />

                        <p:outputLabel value="DIRECCIÓN" for="direccion"/>
                        <p:inputText id="direccion" value="#{personaC.per.domper}" maxlength="50"    requiredMessage="Digitar la direccion" >
                            <p:keyFilter regEx="/[A-Z_a-z_ñ_á_é_í_ó_ú_0_:_._-_ _0-9]/" />                     
                            <p:tooltip for="direccion" value="Digite su Dirección" trackMouse="focus"/>
                            <p:ajax update="msgDireccion" event="keyup" delay="800"  />
                        </p:inputText>
                        <p:message id="msgDireccion" for="direccion" />


                        <p:outputLabel value="Sexo" for="sexo" />
                        <p:selectOneRadio id="sexo" value="#{personaC.per.sexo}"   requiredMessage="Digitar el sexo">
                            <f:selectItem itemLabel="Masculino" itemValue="M" />
                            <f:selectItem itemLabel="Femenino" itemValue="F" />
                            <p:ajax update="msgSexo" event="keyup" delay="800"  />
                        </p:selectOneRadio>
                        <p:message id="msgSexo" for="sexo" />

                        <p:outputLabel value="Cargo"  for="cargo"/>
                        <p:selectOneMenu id="cargo" value="#{personaC.per.cargo}"   requiredMessage="Digitar el cargo" >
                            <f:selectItem itemLabel="Seleccionar" itemValue=""/>
                            <f:selectItem itemLabel="Trabajador" itemValue="Trabajador"/>
                            <f:selectItem itemLabel="Jefe de Área" itemValue="Jefe de Área"/>
                            <f:selectItem itemLabel="Director" itemValue="Director"/>          
                        </p:selectOneMenu>
                        <p:message for="cargo" />



                        <p></p>


                        <p:commandButton value="Registrar" actionListener="#{personaC.registrar()}" update=" :formtwo:tablaPer mensaje"  style="background-color:  background"/>

                    </p:panelGrid>

                </center>
                <!--    Formulario del personal   >-->
            </h:form>



            <h:form id="formtwo">
                <!--              Listado del personal-->
                <p:dataTable var="tblpers" id="tablaPer" value="#{personaC.listadoPer}" rows="10" 
                             paginator="true" widgetVar="tblPersonal" selection="#{personaC.per}" 
                             resizableColumns="true" 
                             selectionMode="single"
                             rowKey="#{tblpers.idper}"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
                             rowsPerPageTemplate="5,10,{ShowAll|'All'}" 
                             rowStyleClass="registroVinculado">

                    <f:facet name="header">
                        <center>
                            <div style="float: left">
                                <h:form>
                                    <p:outputLabel value="FILTRO POR: " style="align-content: center; alignment-adjust: central; color:black font-weight:bold "/>
                                    <center>
                                        <p:selectOneMenu value="#{personaC.tipo}" style="width: 100px">
                                            <f:selectItem itemValue="1" itemLabel="Activos"/> 
                                            <f:selectItem itemValue="2" itemLabel="Inactivos"/>
                                            <f:selectItem itemValue="3" itemLabel="Todos"/>
                                            <p:ajax listener="#{personaC.listar()}" update=":formtwo:tablaPer"/>
                                        </p:selectOneMenu>
                                    </center>
                                </h:form>
                            </div>

                            <p:outputPanel>
                                <h:outputText value="Buscar:"/>
                                <h:inputText id="globalFilter" onkeyup="PF('tblPersonal').filter()" style="width:200px"/>
                            </p:outputPanel>

                            <div style="float: right">
                                <p:commandButton value="Exportar Personas" actionListener="#{personaC.reportePersona()}" 
                                                 ajax="false" style="background-color:yellowgreen;color:black;font-weight:bold;"/>
                                <p:commandButton value="PDF" icon="pi pi-file-pdf" styleClass="p-mr-2 p-mb-2">
                                    <p:dataExporter type="pdf" target=":formtwo:tablaPer" fileName="ListaDelPersonal_PDF" options="#{personaC.pdfOpt}" pageOnly="true" />
                                </p:commandButton>
                                <p:commandButton value="Excel" icon="pi pi-file-excel" styleClass="p-mr-2 p-mb-2">
                                    <p:dataExporter type="xls" target=":formtwo:tablaPer" fileName="ListaDelPersonal_XLS" options="#{personaC.excelOpt}" pageOnly="true" />
                                </p:commandButton>     
                            </div>
                        </center>
                    </f:facet>
                    <p/>


                    <f:facet name= "header" > LISTADO DEL PERSONAL REGISTRADO  </f:facet> 

                    <p:column style="width:30px" headerText="Nombre" sortBy="#{tblpers.nombre}" filterBy="#{tblpers.nombre}">
                        <h:outputText value="#{tblpers.nombre}" />
                    </p:column>           
                    <p:column style="width:40px" headerText="Apellido" sortBy="#{tblpers.apellido}" filterBy="#{tblpers.apellido}">
                        <h:outputText value="#{tblpers.apellido}" />
                    </p:column>
                    <p:column style="width:35px" headerText="Dni"  sortBy="#{tblpers.dni}" filterBy="#{tblpers.dni}">
                        <h:outputText value="#{tblpers.dni}" />
                    </p:column>
                    <p:column style="width:40px" headerText="Celular" sortBy="#{tblpers.celular}" filterBy="#{tblpers.celular}">
                        <h:outputText value="#{tblpers.celular}" />
                    </p:column>
                    <p:column style="width:110px" headerText="Email" sortBy="#{tblpers.email}" filterBy="#{tblpers.email}">
                        <h:outputText value="#{tblpers.email}" />
                    </p:column>              
                    <p:column style="width:92px" headerText="Direccion" sortBy="#{tblpers.domper}" filterBy="#{tblpers.domper}">
                        <h:outputText value="#{tblpers.domper}" />
                    </p:column>  
                    <p:column style="width:35px" headerText="Sexo" sortBy="#{tblpers.sexo}" filterBy="#{tblpers.sexo}">
                        <h:outputText value="#{tblpers.sexo}" >
                            <f:converter converterId="sexoConverter"/>
                        </h:outputText>
                    </p:column>             
                    <p:column style="width:35px" headerText="Cargo" sortBy="#{tblpers.cargo}" filterBy="#{tblpers.cargo}">
                        <h:outputText value="#{tblpers.cargo}" />
                    </p:column>           

                    <f:facet name="footer">     
                        EN TOTAL HAY  #{fn:length(personaC.listadoPer)} REGISTROS.       
                    </f:facet>           
                </p:dataTable>


                <p:contextMenu for="tablaPer">
                    <p:menuitem value="Modificar" icon="pi pi-pencil" oncomplete="PF('wdlgDatos').show()" update=":formthree">
                    </p:menuitem>
                    <p:menuitem value="Eliminar" icon="pi pi-trash" actionListener="#{personaC.DeleteEstado()}" update=":formtwo:tablaPer mensaje">
                        <p:confirm header="Confirmación" message="¿Deseas eliminar?"/>                         
                    </p:menuitem>
                </p:contextMenu>


                <!--            Listado de la persona-->
            </h:form>


            <!--DATOS DEL PERSONAL-->
            <p:dialog header="Datos del personal" widgetVar="wdlgDatos" id="dlgDatos">
                <h:form id="formthree">
                    <p:panelGrid columns="3">                          
                        <p:outputLabel value="Nombre" for="NOMPER"/>
                        <p:inputText id="NOMPER"  value="#{personaC.per.nombre}" maxlength="30"  required="true" requiredMessage="Digitar sus nombres">
                            <p:keyFilter regEx="/[A-Z_a-z_ñ_á_é_í_ó_ú_ ]/"/>
                            <!--                            <f:validator validatorId="Nombres" />-->
                            <p:ajax update="msgNombres" event="keyup" delay="800"  />
                            <p:tooltip for="NOMPER" value="Digite sus dos nombres" trackMouse="focus"/>
                        </p:inputText> 

                        <p:message  id="msgNombres" for="NOMPER" />
                        <p:outputLabel value="Apellido" />
                        <p:inputText id="APEPER"  value="#{personaC.per.apellido}" maxlength="30"  required="true" requiredMessage="Digitar sus apellidos">
                            <p:keyFilter regEx="/[A-Z_a-z_ñ_á_é_í_ó_ú_ ]/"/>
                            <!--                            <f:validator validatorId="Apellidos" />-->
                            <p:ajax update="msgApellidos" event="keyup" delay="800"  />
                            <p:tooltip for="APEPER" value="Digite sus dos apellidos" trackMouse="focus"/>
                        </p:inputText> 
                        <p:message  id="msgApellidos" for="APEPER" />

                        <p:outputLabel value="DNI" />
                        <p:inputText id="DNI" value="#{personaC.per.dni}" maxlength="8"  required="true" requiredMessage="Digitar el dni">
                            <p:keyFilter regEx="/[0-9]/" />
                            <f:validator validatorId="vDni" />
                            <p:ajax  update="msgDni" delay="800" event="keyup" />
                            <p:tooltip for="DNI" value="Digite su Dni" trackMouse="focus"/>
                        </p:inputText> 
                        <p:message id="msgDni" for="DNI"  showDetail="true" />


                        <p:outputLabel value="Celular" for="celular"/> 
                        <p:inputText id="celular" value="#{personaC.per.celular}" maxlength="9" style="width: 310px;" required="true" requiredMessage="Digitar su Celular">
                            <p:keyFilter regEx="/[0-9]/"/>
                            <f:validator validatorId="vCelular" />
                            <f:validateLength minimum="9" maximum="9"/>
                            <p:ajax update="msgCelular" event="keyup" delay="800"  />
                            <p:tooltip for="celular" value="Digite su Celular" trackMouse="focus"/>
                        </p:inputText>                   
                        <p:message id="msgCelular" for="celular"/>

                        <p:outputLabel value = "Email" for="txtCorreo"/>
                        <p:inputText value ="#{personaC.per.email}" id="txtCorreo" maxlength="50" required="true"
                                     requiredMessage="Ingrese correo electrónico" style="width: 100%" >
                            <f:validator validatorId="vCorreo" />
                            <p:ajax  update="msgCorreo" delay="800" event="keyup" />
                            <p:tooltip for="txtCorreo" value="Digite su Correo" trackMouse="focus"/>
                        </p:inputText>
                        <p:message id="msgCorreo" for="txtCorreo"  showDetail="true" />


                        <p:outputLabel value="DIRECCIÓN" for="direccion"/>
                        <p:inputText id="direccion" value="#{personaC.per.domper}" maxlength="50"   required="true" requiredMessage="Digitar la direccion" >
                            <p:keyFilter regEx="/[A-Z_a-z_ñ_á_é_í_ó_ú_0_:_._-_ _0-9]/" />                     
                            <p:tooltip for="direccion" value="Digite su Dirección" trackMouse="focus"/>
                            <p:ajax update="msgDireccion" event="keyup" delay="800"  />
                        </p:inputText>
                        <p:message id="msgDireccion" for="direccion" />

                        <p:outputLabel value="Sexo" for="sexo" />
                        <p:selectOneRadio id="sexo" value="#{personaC.per.sexo}"  required="true" requiredMessage="Digitar el sexo">
                            <f:selectItem itemLabel="Masculino" itemValue="M" />
                            <f:selectItem itemLabel="Femenino" itemValue="F" />
                            <p:ajax update="msgSexo" event="keyup" delay="800"  />
                        </p:selectOneRadio>
                        <p:message id="msgSexo" for="sexo" />


                        <p:outputLabel value="Cargo" />
                        <p:selectOneMenu id="option" value="#{personaC.per.cargo}"  required="true" requiredMessage="Digitar el cargo" >
                            <f:selectItem itemLabel="Seleccionar" itemValue=""/>
                            <f:selectItem itemLabel="Trabajador" itemValue="Trabajador"/>
                            <f:selectItem itemLabel="Jefe de Área" itemValue="Jefe de Área"/>
                            <f:selectItem itemLabel="Director" itemValue="Director"/>
                        </p:selectOneMenu>

                        <p></p>
                        <p:commandButton value="Modificar" actionListener="#{personaC.modificar()}" 
                                         update=":formtwo:tablaPer" oncomplete="PF('wdlgDatos').hide();" >
                            <p:confirm header="Confirmación" message="¿Deseas Modificar?" icon="ui-icon-alert"/>
                            <p:tooltip trackMouse="true"/>
                        </p:commandButton>
                        <p:commandButton value="Cancelar" immediate="true" oncomplete="PF('wdlgDatos').hide();" />
                        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                            <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"/>
                            <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close"/>
                        </p:confirmDialog>
                    </p:panelGrid>
                </h:form>
            </p:dialog>
        </h:body>
    </ui:define>
</ui:composition>
